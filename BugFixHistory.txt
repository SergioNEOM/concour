Concour (версия от 25/09/2018) передан на бета-тестинг.
==============================================================

2018-12-10 Очередь на изменения:
================================
1) Дата проведения соревнований: добавить второе поле с датой (если не в один день проводится).
  В БД можно хранить к-во дней (duration), а не 2 дату. (!! Отследить, на что повлияет)
2) В окне параметров маршрута вводить название и тип, остальные параметры - из главного окна!
3) Привязать список в справочнике маршрутов к соревнованию: у нового соревнования список должен быть пустым
4) На главной форме исправить название: вместо К-во препятствий надо К-во прыжков
5) Дать возможность пользователю изменять названия колонок с препятствиями.
 Заголовки сохранять в БД вместе с остальными переметрами маршрута (и получать их при смене)
6) Пофиксить: параметры, выставленные в главном окне (к-во прыжков, дистанция и т.п.) не сохраняются в БД,
 а смена маршрута сбрасывает их
7) Справочник всадников выводить по алфавиту
8) Справочник лошадей выводить по алфавиту
9) Вынести работу со справочниками в отдельное приложение. Из основного приложения пока не убирать...
10)В перепрыжку не выбирать участников с нулевым временем (не полные данные)
11)Добавить кнопку(чекбокс) "Перепрыжка сразу": показать перепрыжку для конкретного участника, если время не пусто, а штрафов нет.
 Продумать, как сохранить данные "Быстрой" перепрыжки, чтобы они показывались в обычной, и печатались в отчете, даже если общая перепрыжка не получилась
12)Справа, на свободном месте выводить примерного лидера маршрута, отслеживать изменения в динамике. Для классики - всегда, для перепрыжки - когда там есть данные
13)В поле "Всадник" основной таблицы выводить фамилию и имя
14)В судейском протоколе, в варианте с перепрыжкой, добавить строку со своим количеством прыжков для ввода данных по перепрыжке
15)Добавить обработку типа "маршрут по возрастающей сложности":
   -----------------------------------------------------------
  Обычно 8 или 10 препятствий. Задача - получить бОльшую сумму баллов при меньшем времени.
За правильное прохождение каждого из препятствий начисляются баллы, соответствующие № препятствия (за первое - один балл, за второе - два и т.д.).
Если препятствие сбито - баллы за него к общей сумме не прибавляются.
В случае "закидки" лошади всаднику предоставляется возможность повторно преодолеть препятствие, но уже за вычетом штрафных очков.
Формула суммирования баллов: S = S + №преп - Штраф.
Если препятствие сбито после "закидки", то баллы за данное препятствие не добавляются, а штрафные очки вычитаются из суммы баллов.

Рядом с последним препятствием устанавливается дополнительное, повышенной сложности (Джокер),
которое участник может преодолеть вместо последнего для получения большего количества баллов (за чистое прохождение к общей сумме добавляется 20 баллов,
но за сбитого джокера эти 20 баллов из суммы вычитают!).
В таблице это поле идёт после последнего препятствия (имя по умолчанию - "J").
В случае "закидки" на Джокере участник получает штраф (как обычно, вычитается из суммы), и может повторно преодолеть препятствие.
!!!Важно!!! Для этого повторного прыжка участник имеет право уйти от Джокера и вернуться к последнему препятствию, получив(или не получив) за него к-во баллов =№
Если после "закидки" на Джокере участник его сбивает, из его суммы баллов вычитаются 20 очков за препятствие и все штрафные очки за закидку.
--
Если участник потратил на маршрут больше расчетного времени, то из суммы его баллов вычитаются штрафные очки за превышение времени (их расчет как в классике).
--
Окончательный рейтинг участников строится по:
 а) по сумме баллов (может быть отрицательной)
 б) по времени (пр равенстве сумм баллов)
 в) в очень редком случае равенства а) и б) - участиники делят место (один номер).
-----------
Предварительный регламент ввода данных в ячейки основной таблицы по препятствиям:
положительное число - препятсвие пройдено (надо ли проверять соотвествие № ?)
ноль - препятствие сбито, но штраф за закидку не начислялся
отрицательное число - была закидка, и штраф за неё больше баллов за препятствие, либо сбитый Джокер.
Итог - арифметическое сложение данных из ячеек.
=================================================================================

2018-12-10
==========
1) п.13 требований: В поле "Всадник" показывать фамилию и имя.
 В основной запрос SEL_GIT (concour_DM) добавил сцепку || с пробелом-разделителем и именем, оставив имя колонки lastname;
 В главном гриде увеличил видимую ширину колонки lastname со 150 до 200px, а также MaxSize до 56;
2) п.п.7,8: всадники и лошади - по алфавиту.
 Внёс изменеия в БД - добавил предложения ORDER BY в "v_riders", "v_horses".
---
 На АРМ у заказчика пока проделать вручную, в интерпретаторе (.read updates_2018-12-10.sql)

2018-12-11
==========
1) Добавил в БД таблицу "vers" для учёта изменений

2) по п.1: вторая дата соревнований
 Добавил поле tourdate2 в tournaments и в v_tournaments;
 Добавил поле ввода даты на форму параметров соревнования;
 Внёс изменения в DM - в процедуры AddTournament и OpenTournament для записи
второй даты в БД, в FillRepParams - добавление параметра - второй даты;
 Модуль concour_export, проц. MakeRepHeader - добавил вывод второй даты
в ту же ячейку (через разделитель chr(10)) в случае, если даты не одинаковые.

3) по п.14 доп.строка в судейском протоколе
 Поменял последовательность номеров в константах rty_*;
 Добавил константу rty_RefReJump=-3 - для перепрыжки в суд.протоколе;
 Изменил список параметров в процедуре MakeStartXLS - вместо Bool поставил
RepType:Integer;
 Перед концом цикла по списку участников поставил печать доп.ячеек для
перепрыжки (по условию).
---
 На АРМ у заказчика пока проделать вручную, в интерпретаторе (.read updates_2018-12-11.sql)

2018-12-13
==========
1) по п.4: поменял текст на "К-во прыжков" и на TabSheet1, и на TabSheet2
2) по п.5: заголовки колонок
 Добавил поле в "routes" - colnames varchar(360) для
хранения заголовков (2 х 16полей х 10знаков + разделители);
 В DataModule добавил переменную ColNames типа TStringList, 
которая инициализируется в OnCreate, уничтожается OnDestroy модуля;
 При смене маршрута заголовки строкой читаются из БД (в ColNames.DelimitedText)
и при необходимости отрисовываются в проц. SetColNames(гл.формы),
где перебором подменяются текущие заголовки колонок
 (сейчас установлен фильтр только для полей "foul1_b" и "foul2_b");

 !!! Продумать и доделать: вывод измененных названий на печать???  !!!
---
 На АРМ у заказчика пока проделать вручную, в интерпретаторе (.read updates_2018-12-13.sql)

2018-12-17
==========
1) по п.3: связать турниры и маршруты
  Добавил поле tournament в таблицу  routes (и в v_routes);
 Поле запроса списка маршрутов (проц OpenRoute) формируется по условию:
   'where tournament=:p1' с подстановкой CurrTournament.
 В проц AddRoute добавлен столбец tournament и параметр p9 для него.
!! Сложность возникает в привязке существующих данных, если записи в git привязаны к одним маршрутам, но
      в разных соревнованиях !!! В этом случае нужно создавать дублёры маршрутов и корректировать привязку!
---
 На АРМ у заказчика пока проделать вручную, в интерпретаторе (.read updates_2018-12-17.sql)

2018-12-19
==========
1) по п.10 - отбор в перепрыжку только с заполненным полем времени гита
 В главном модуле, в проц.CalcPlaces, для типа маршрута 1 (Перепр.),
 в запросе отбора записей добавил условие  gittime1>0
2) по п.9 - внешнее приложение
 Вынес работу со справочниками в отдельное приложение (подкаталог JumperList),
основной функционал скопировал из гл.приложения.
!! Не протестировано полностью!!
!!! Обнаружилось осложение: файл БД открывается монопольно, поэтому внешнее
приложение может работать только если основное закрыто (и наоборот) !!!!
Во внешнем приложении ошибка подключения к БД (возникает не после Connect,
а после StartTransaction) обрабатывается, но в основном - надо предусмотреть!!!

2018-12-20
==========
1) по п.6 - обновление параметров маршрута из главного окна
 В DM добавил процедуру: RouteSetField для заполнения любого поля в Route,
 а в гл.модуле, у всех полей параметров, в событии OnChangeEditing её вызываю
 (в т.ч. для перепрыжки)


2018-12-26-...
==============
!!!Откатился с попытки от 25-12-2018г. на 20-12-2018г.
                         - т.к. вариант требует слишком много изменений
---
1) по п.11 - Перепрыжка сразу: 
 Пока видится вариант, когда нужный участник выбирается правой кнопкой
 (там соотв. пункт меню ), а в гриде с перепрыжкой будет только одна строка -
 с ним. Для этого изменить проц.OpenGit(?).
!А не нужно ли показывать всех предыдущих участников "быстрой перепрыжки"?
 После заполнения данных надо предусмотреть возврат в основной список
 После подведения итогов основного гита этот участник либо попадает
 в перепрыжку автоматически (по условиям выбора) и ранжируется, либо нет (что
 в этом случае делать?).
 !! Проверить, что данные не стираются при подведении итогов осн.гита
 !? Проверить, будут ли выводиться данные перепрыжки в отчёте у неранжированных!!
! При нынешнем алгоритме ранжирования участники перепрыжки выстраиваются перед
остальными, но при ручном выборе в перепрыжку пишется любой(он же там остаётся?)!

Поле overlap таблицы git надо задействовать для индикации, что участник был на
перепрыжке и его данные надо учитывать (=1). В этом случае выборку для показа
участников перепрыжки надо делать не по SELECT IN, а по WHERE overlap=1
(исправить везде, чтобы не было путаницы). Тогда OverList уже не требуется?
 ! нЕЯСНО, стоит ли при обновлении устанавливать overlap=1 для записей, где 
 gittime2>0 или totalfouls2>0... т.к. этом списке могут оказаться те,
 кто попал туда в процессе тестирования...

!!! Как сдвигать номера мест основного гита в случае добавления участника
в режиме "быстрой перепрыжки"?


 1) Убрал из проекта модуль concour_rep, т.к. html-отчеты не актуальны.
Дополнительно убрал RepPopupMenu и события 
 2) В DM заменил проц. SetFire на функцию GitSetField - теперь любое поле
можно изменять, что позволит не только изменять признак перепрыжки, но и 
расставлять места
 3) В гл.форме убрал OverList, и в проц. CalcPlaces убрал переменную over -
ранее накапливавшие участников перепрыжки - теперь всё сразу пишется в Git.
При этом, во многих местах убрал их в условиях отбора в перепрыжку, заменив
на доп.условие в SELECT...
 4) В CalcPlaces ввёл флаг WasOver, чтобы выводить сообщение о попадании
в перепрыжку
 5) Поправил DM.OpenGit с учётом новых условий отбора в перепрыжку
 6) в коммите от 2018-12-27 пока закомментил CalcPlacesOver, т.к. надо
продумать алгоритм...

